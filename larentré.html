<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="img/logo2.png" type="image/png" />
    <title>La rentrée – MA LOU</title>

    <!-- Typos -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Quicksand:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Feuilles existantes -->
    <link rel="stylesheet" href="style/style.css" />
    <link rel="stylesheet" href="style/header.css" />
    <link rel="stylesheet" href="style/footer.css" />

    <style>
      :root {
        --noir: #000;
        --beige: #e8dbcd;
      }
      body {
        margin: 0;
        background: var(--beige);
        font-family: "Quicksand", sans-serif;
        color: #3f3027;
      }

      .container {
        max-width: 1240px;
        margin: 24px auto 80px;
        padding: 0 18px;
      }
      .page-head {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin: 6px 0 22px;
        border-left: 6px solid rgba(0, 0, 0, 0.06);
        padding-left: 12px;
      }
      .title {
        font-family: "Cormorant Garamond", serif;
        font-size: 38px;
        margin: 0;
      }
      .count {
        font-size: 14px;
        opacity: 0.7;
      }

      /* grille */
      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 14px;
      }
      @media (min-width: 1200px) {
        .grid {
          grid-template-columns: repeat(4, minmax(0, 1fr));
          gap: 20px;
        }
      }

      /* carte produit */
      .card {
        background: var(--beige);
        display: flex;
        flex-direction: column;
      }
      .img-wrap {
        aspect-ratio: 3/4;
        overflow: hidden;
        position: relative;
      }
      .img-wrap img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        inset: 0;
        transition: opacity 0.3s ease;
      }
      .img-wrap img:nth-child(1) {
        opacity: 1;
      }
      .img-wrap img:nth-child(2) {
        opacity: 0;
      }
      .card:hover .img-wrap img:nth-child(1) {
        opacity: 0;
      }
      .card:hover .img-wrap img:nth-child(2) {
        opacity: 1;
      }

      .card h3 {
        font-family: "Cormorant Garamond", serif;
        font-size: 16px;
        margin: 10px 0 4px;
      }
      .price {
        font-weight: 700;
        font-size: 14px;
        margin: 0 0 10px;
      }
      .btn {
        display: inline-block;
        border: none;
        border-radius: 999px;
        padding: 12px 0;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
      }
      .btn.preview {
        background: var(--noir);
        color: #fff;
      }

      /* ---- MODALE responsive (fixes) ---- */
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 16px;
        z-index: 200000 !important; /* au-dessus du header */
      }
      .modal.open {
        display: flex;
      }
      .modal-card {
        background: #fff;
        border-radius: 12px;
        max-width: min(900px, 96vw);
        max-height: 92svh;
        width: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      /* Croix visible et cliquable */
      .close-x {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 36px;
        font-weight: bold;
        line-height: 1;
        color: #000;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 200001; /* au-dessus du contenu de la modale */
        border: none;
        transition: background 0.2s ease;
      }
      .close-x:hover {
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
      }

      .modal-body {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 16px;
        flex: 1 1 auto;
        min-height: 0;
        overflow: auto; /* scroll si contenu long */
        -webkit-overflow-scrolling: touch;
      }
      @media (min-width: 900px) {
        .modal-body {
          grid-template-columns: 1fr 1fr;
          gap: 22px;
          padding: 22px;
        }
      }
      .modal-images img.big {
        width: 100%;
        object-fit: contain;
        background: #f6f3ef;
        max-height: 48svh; /* évite que l’image prenne tout l’écran */
      }
      .thumbs {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 6px;
        margin-top: 10px;
      }
      .thumbs img {
        width: 100%;
        cursor: pointer;
      }

      .modal-title {
        font-family: "Cormorant Garamond", serif;
        font-size: 22px;
        margin: 0 0 6px;
      }
      .modal-price {
        font-weight: 700;
        margin: 0 0 10px;
      }
      .modal-desc {
        font-size: 14px;
        margin: 0 0 12px;
        white-space: pre-line; /* pour afficher les \n */
      }
      #modalBuyTarget {
        max-height: 40svh; /* si beaucoup d’options/variants */
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Bloquer le scroll du fond quand la modale est ouverte */
      body.modal-open {
        overflow: hidden;
        touch-action: none;
      }

      /* Drawer panier Shopify toujours au-dessus */
      .shopify-buy-frame,
      .shopify-buy-cart-wrapper,
      .shopify-buy__cart {
        z-index: 200000 !important;
      }

      /* Boutons Shopify unify */
      .shopify-buy__btn {
        background-color: var(--noir) !important;
        border-radius: 999px !important;
        font-weight: 700 !important;
        color: #fff !important;
        padding: 12px 0 !important;
      }
      .shopify-buy__btn:hover,
      .shopify-buy__btn:focus {
        background-color: var(--noir) !important;
      }
      .shopify-buy__cart__footer .shopify-buy__btn {
        background-color: var(--noir) !important;
      }
      .shopify-buy__cart__footer .shopify-buy__btn:hover,
      .shopify-buy__cart__footer .shopify-buy__btn:focus {
        background-color: var(--noir) !important;
      }

      /* Panier Shopify iframe: pleine hauteur pour voir le bouton Payer */
      .shopify-buy-frame--cart {
        height: 100svh !important;
        max-height: 100svh !important;
      }
      @supports not (height: 100svh) {
        .shopify-buy-frame--cart {
          height: 100vh !important;
          max-height: 100vh !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="bandeau-livraison">
      <div class="bandeau-slider">
        <div class="slide">
          livraison offerte en point relai dès 80€ d’achat
        </div>
        <div class="slide">Livraison offerte à domicile dès 100€ d’achat</div>
        <div class="slide">
          livraison offerte en point relai dès 80€ d’achat
        </div>
        <div class="slide">Livraison offerte à domicile dès 100€ d’achat</div>
      </div>
    </div>
    <div id="header"></div>

    <main class="container">
      <div class="page-head">
        <h1 class="title">La rentrée</h1>
        <div class="count" id="count">—</div>
      </div>
      <div id="grid" class="grid"></div>
    </main>

    <!-- Modale Aperçu -->
    <div id="quickModal" class="modal" aria-hidden="true">
      <div
        class="modal-card"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
      >
        <button id="modalClose" class="close-x" aria-label="Fermer">×</button>
        <div class="modal-body">
          <div class="modal-images">
            <img id="modalBig" class="big" alt="" />
            <div id="modalThumbs" class="thumbs"></div>
          </div>
          <div>
            <h3 id="modalTitle" class="modal-title"></h3>
            <div id="modalPrice" class="modal-price"></div>
            <p id="modalDesc" class="modal-desc"></p>
            <div id="modalBuyTarget"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- SDK Shopify -->
    <script src="https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js"></script>
    <script>
      const SHOP_DOMAIN = "eb1iv0-n1.myshopify.com";
      const STOREFRONT_TOKEN = "5de76971549ee7a5dcb338aaad5e9784";

      // ⚠️ Produits (inchangés)
      const items = [
        {
          key: "pantalon-london",
          title: "Pantalon London",
          priceText: "39,99 €",
          productId: "15288947868022",
          image1: "img/Larentree/pantalon-london-1.jpg",
          image2: "img/Larentree/pantalon-london-2.jpg",
          desc: "- Coupe fluide, jambe large, confort optimal\n- Motif à carreaux tons automnaux\n- Look décontracté-chic avec t-shirt noir ou chemise oversize\n- Lou porte une taille M et mesure 1m71",
        },
        {
          key: "jean-bandana",
          title: "Jean Bandana",
          priceText: "42,00 €",
          productId: "15288935252342", // (repris d'Été 99)
          image1: "img/ete99/jean-bandana-1.jpg",
          image2: "img/ete99/jean-bandana-2.jpg",
          desc: "- Coupe droite légèrement large, esprit vintage\n- Délavage bleu\n- Imprimé patchwork façon bandana\n- À porter avec t-shirt blanc ou top coloré\n- Lou porte une taille 36 et mesure 1m71",
        },
        {
          key: "ibiza-pantalon",
          title: "Pantalon Ibiza",
          priceText: "58,00 €",
          productId: "15288688509302",
          image1: "img/ete99/ibiza-pantalon-1.jpg",
          image2: "img/ete99/ibiza-pantalon-2.jpg",
          desc: "Taille unique L.\n- Maille à rayures multicolores, doublée, taille haute\n- Coupe large et fluide, confort absolu\n- Style rétro et joyeux\n- À porter en ville ou en bord de mer\n- Lou porte une M et mesure 1m71",
        },
        {
          key: "ibiza-veste",
          title: "Veste Ibiza",
          priceText: "66,00 €",
          productId: "15288702206326", // (repris d'Été 99)
          image1: "img/ete99/ibiza-veste-1.jpg",
          image2: "img/ete99/ibiza-veste-2.jpg",
          desc: "Taille unique.\n- Veste zippée en maille multicolore à rayures\n- Coupe loose, doublure intérieure contrastée\n- À porter seule ou avec le pantalon coordonné\n- Lou porte une taille unique et mesure 1m71",
        },
        {
          key: "trench-brooklyn",
          title: "Trench Brooklyn",
          priceText: "61,00 €",
          productId: "15288944099702",
          image1: "img/Larentree/trench-brooklyn-1.jpg",
          image2: "img/Larentree/trench-brooklyn-2.jpg",
          desc: "Taille unique.\n- Coupe oversize et légèrement courte\n- Denim léger à fines rayures verticales\n- Double boutonnage, larges revers\n- Lou porte une taille unique et mesure 1m71",
        },
        {
          key: "top-candy",
          title: "Top Candy",
          priceText: "26,00 €",
          productId: "15288856084854",
          image1: "img/Larentree/top-candy-1.jpg",
          image2: "img/Larentree/top-candy-2.jpg",
          desc: "- Maille côtelée, manches courtes\n- Coupe près du corps\n- Confortable et facile à associer\n- Le basique coloré qui booste les tenues\n- Lou porte une taille S/M et mesure 1m71",
        },
        {
          key: "chemise-safari-pop",
          title: "Chemise Safari Pop",
          priceText: "68,00 €",
          productId: "15288842486134",
          image1: "img/Larentree/chemise-safari-pop-1.jpg",
          image2: "img/Larentree/chemise-safari-pop-2.jpg",
          desc: "Taille unique.\n- Chemise oversize à imprimé\n- Couleurs vives, col contrasté\n- Manches courtes à revers graphiques\n- Pièce forte pour affirmer son style\n- Convient du 36 au 42\n- Lou porte une taille unique et mesure 1m71",
        },
        {
          key: "gilet-perle",
          title: "Gilet Perle",
          priceText: "36,00 €",
          productId: "15288838586742",
          image1: "img/Larentree/gilet-perle-1.jpg",
          image2: "img/Larentree/gilet-perle-2.jpg",
          desc: "Taille unique M/L.\n- Maille écrue, manches courtes\n- Boutons dorés et poches plaquées\n- Col rond, coupe droite légèrement courte\n- Lou porte une taille M et mesure 1m71",
        },
        {
          key: "polo-capri",
          title: "Polo Capri",
          priceText: "34,00 €",
          productId: "15288828133750",
          image1: "img/Larentree/polo-capri-1.jpg",
          image2: "img/Larentree/polo-capri-2.jpg",
          desc: "- Maille rayée rouge et blanc\n- Coupe droite, col avec ouverture en V\n- Détail ajouré\n- Lou porte une taille S/M et mesure 1m71",
        },
        {
          key: "debardeur-mariniere",
          title: "Débardeur Marinière",
          priceText: "33,00 €",
          productId: "15288823939446", // (repris d'Été 99)
          image1: "img/ete99/debardeur-mariniere-1.jpg",
          image2: "img/ete99/debardeur-mariniere-2.jpg",
          desc: "- Rayé esprit marinière\n- Boutons dorés décoratifs sur l’épaule\n- Coupe droite légèrement raccourcie\n- Un basique revisité\n- Lou porte une taille S/M et mesure 1m71",
        },
        {
          key: "pull-fluffy",
          title: "Pull Fluffy",
          priceText: "39,99 €",
          productId: "15288808145270",
          image1: "img/Larentree/pull-fluffy-1.jpg",
          image2: "img/Larentree/pull-fluffy-2.jpg",
          desc: "Taille unique.\n- Pull sans manches ultra doux (mohair)\n- Coupe légèrement raccourcie\n- À porter seul ou sur un t-shirt\n- Coloris : rose, vert pastel, jaune\n- Lou porte une taille unique et mesure 1m71",
        },
        {
          key: "gilet-nomade",
          title: "Gilet Nomade",
          priceText: "35,00 €",
          productId: "15288773443958",
          image1: "img/Larentree/gilet-nomade-1.jpg",
          image2: "img/Larentree/gilet-nomade-2.jpg",
          desc: "- Gilet sans manches brodé\n- Détails et finitions contrastées\n- Facile sur t-shirt ou robe fluide\n- Existe en kaki et écru\n- Lou porte une taille M et mesure 1m71",
        },
        {
          key: "blouse-jaipur",
          title: "Blouse Jaïpur",
          priceText: "41,00 €",
          productId: "15288730747254",
          image1: "img/Larentree/blouse-jaipur-1.jpg",
          image2: "img/Larentree/blouse-jaipur-2.jpg",
          desc: "- Blouse légère crème à broderies contrastées\n- Détails travaillés (manches, poignets, devant)\n- Fermeture boutonnée bordée de jaune\n- Style bohème chic (jean ou jupe fluide)\n- Lou porte une taille M (effet loose) et mesure 1m71",
        },
        {
          key: "chemise-ciel",
          title: "Chemise Ciel",
          priceText: "41,00 €",
          productId: "15288708366710",
          image1: "img/Larentree/chemise-ciel-1.jpg",
          image2: "img/Larentree/chemise-ciel-2.jpg",
          desc: "Taille unique M.\n- Blouse fluide bleu clair\n- Détail froncé le long de la boutonnière\n- Intemporel, bureau comme week-end\n- Lou porte une taille S et mesure 1m71",
        },
        {
          key: "gilet-riviera",
          title: "Gilet Riviera",
          priceText: "36,00 €",
          productId: "15288653316470",
          image1: "img/Larentree/gilet-riviera-1.jpg",
          image2: "img/Larentree/gilet-riviera-2.jpg",
          desc: "Taille unique M/L.\n- Gilet sans manches rayures jaune & blanc\n- Coupe droite, boutons dorés texturés\n- À porter seul ou sur chemise blanche\n- Lou porte une taille S et mesure 1m70",
        },
      ];

      const grid = document.getElementById("grid");
      document.getElementById("count").textContent = `${items.length} articles`;

      // Grille produits
      items.forEach((p, i) => {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="img-wrap">
            <img src="${p.image1}" alt="${escapeHtml(p.title)}">
            <img src="${p.image2}" alt="${escapeHtml(p.title)}">
          </div>
          <h3>${escapeHtml(p.title)}</h3>
          <div class="price">${p.priceText}</div>
          <button class="btn preview" data-index="${i}">Aperçu</button>`;
        grid.appendChild(card);
      });

      // Panier global
      let shopifyUI = null;
      function initUI() {
        return new Promise((res) => {
          if (window.ShopifyBuy && window.ShopifyBuy.UI) {
            const client = ShopifyBuy.buildClient({
              domain: SHOP_DOMAIN,
              storefrontAccessToken: STOREFRONT_TOKEN,
            });
            ShopifyBuy.UI.onReady(client).then((ui) => res(ui));
          } else {
            const s = document.createElement("script");
            s.src =
              "https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js";
            s.onload = () => initUI().then(res);
            document.body.appendChild(s);
          }
        });
      }
      initUI().then((ui) => {
        shopifyUI = ui;
        ui.createComponent("cart", {
          node: document.body.appendChild(document.createElement("div")),
          moneyFormat: "€{{amount_with_comma_separator}}",
          options: {
            cart: {
              text: {
                title: "Panier",
                total: "Total",
                empty: "Votre panier est vide 🥲",
                notice:
                  "Les codes de réduction et frais de livraison seront appliqués lors du paiement.",
                button: "Payer",
              },
              styles: {
                button: {
                  "background-color": "#000000",
                  color: "#ffffff",
                  "border-radius": "999px",
                  "font-weight": "700",
                  padding: "12px 0",
                  ":hover": { "background-color": "#000000" },
                  ":focus": { "background-color": "#000000" },
                },
                cart: { "background-color": "#e8dbcd" },
                footer: { "background-color": "#e8dbcd" },
                title: { color: "#000" },
                header: { color: "#000" },
                lineItems: { color: "#000" },
                subtotalText: { color: "#000" },
                subtotal: { color: "#000" },
                notice: { color: "#000" },
                currency: { color: "#000" },
                close: { color: "#000" },
              },
            },
            toggle: {
              styles: {
                toggle: {
                  "background-color": "#000000",
                  color: "#ffffff",
                  ":hover": { "background-color": "#000000" },
                  ":focus": { "background-color": "#000000" },
                },
              },
            },
          },
        });
        ui.createComponent("toggle", {
          node: document.body.appendChild(document.createElement("div")),
          moneyFormat: "€{{amount_with_comma_separator}}",
        });
      });

      // Modale
      const modal = document.getElementById("quickModal");
      const modalClose = document.getElementById("modalClose");
      const modalBig = document.getElementById("modalBig");
      const modalThumbs = document.getElementById("modalThumbs");
      const modalTitle = document.getElementById("modalTitle");
      const modalPrice = document.getElementById("modalPrice");
      const modalDesc = document.getElementById("modalDesc");
      const modalBuyTarget = document.getElementById("modalBuyTarget");

      grid.addEventListener("click", (e) => {
        const btn = e.target.closest(".btn.preview");
        if (!btn) return;
        openQuick(items[btn.dataset.index]);
      });
      modalClose.addEventListener("click", closeQuick);
      modal.addEventListener("click", (e) => {
        if (e.target === modal) closeQuick();
      });
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeQuick();
      });

      function openQuick(p) {
        modalTitle.textContent = p.title;
        modalPrice.textContent = p.priceText;
        modalDesc.textContent = p.desc;
        modalBig.src = p.image1;
        modalThumbs.innerHTML = "";
        [p.image1, p.image2].filter(Boolean).forEach((url) => {
          const im = document.createElement("img");
          im.src = url;
          im.alt = p.title;
          im.addEventListener("click", () => (modalBig.src = url));
          modalThumbs.appendChild(im);
        });

        // Buy Button dans la modale
        modalBuyTarget.innerHTML = "";
        const mount = (ui) => {
          ui.createComponent("product", {
            id: p.productId,
            node: modalBuyTarget,
            moneyFormat: "€{{amount_with_comma_separator}}",
            options: {
              product: {
                contents: {
                  img: false,
                  title: false,
                  price: false,
                  options: true,
                },
                text: { button: "Ajouter" },
                styles: {
                  button: {
                    "background-color": "#000000",
                    color: "#ffffff",
                    "font-weight": "700",
                    padding: "12px 12px",
                    ":hover": { "background-color": "#000000" },
                    ":focus": { "background-color": "#000000" },
                  },
                },
              },
              cart: {
                text: { button: "Payer", total: "Total", title: "Panier" },
                styles: {
                  button: {
                    "background-color": "#000000",
                    color: "#ffffff",
                    ":hover": { "background-color": "#000000" },
                    ":focus": { "background-color": "#000000" },
                  },
                },
              },
            },
          });
        };
        if (shopifyUI) mount(shopifyUI);
        else initUI().then(mount);

        modal.classList.add("open");
        modal.setAttribute("aria-hidden", "false");
        document.body.classList.add("modal-open");
      }

      function closeQuick() {
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden", "true");
        modalBuyTarget.innerHTML = "";
        document.body.classList.remove("modal-open");
      }

      function escapeHtml(s) {
        return String(s || "").replace(
          /[&<>"']/g,
          (m) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[m])
        );
      }
    </script>

    <div id="footer"></div>
    <script src="script/script.js"></script>
  </body>
</html>
