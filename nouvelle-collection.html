<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="img/logo2.png" type="image/jpeg" />

    <title>Nouvelle Collection</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style/style.css" />

    <link rel="stylesheet" href="style/nouvelle-collection.css" />
    <link rel="stylesheet" href="style/header.css" />
    <link rel="stylesheet" href="style/footer.css" />
  </head>
  <body>
    <div class="bandeau-livraison">
      <div class="bandeau-slider">
        <div class="slide">Livraison Ã  domicile dans toute la France ðŸ‡«ðŸ‡·</div>
        <div class="slide">Livraison gratuite dÃ¨s 80â€¯â‚¬ d'achat</div>
        <div class="slide">Paiement 100% sÃ©curisÃ© ðŸ’³</div>
        <div class="slide">NouveautÃ©s chaque semaine âœ¨</div>
      </div>
    </div>
    <div id="header"></div>

    <main class="collection-container">
      <h1 class="page-title">Nouvelle collection</h1>
      <div id="collection-node" class="shopify-collection-node"></div>
    </main>

    <div id="footer"></div>

    <script>
      (function () {
        var scriptURL =
          "https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js";
        if (window.ShopifyBuy && window.ShopifyBuy.UI) {
          ShopifyBuyInit();
        } else {
          var s = document.createElement("script");
          s.async = true;
          s.src = scriptURL;
          s.onload = ShopifyBuyInit;
          (document.head || document.body).appendChild(s);
        }

        function ShopifyBuyInit() {
          var client = ShopifyBuy.buildClient({
            domain: "eb1iv0-n1.myshopify.com",
            storefrontAccessToken: "5de76971549ee7a5dcb338aaad5e9784",
          });

          ShopifyBuy.UI.onReady(client).then(function (ui) {
            ui.createComponent("collection", {
              id: "677036884342",
              node: document.getElementById("collection-node"),
              moneyFormat: "%E2%82%AC%7B%7Bamount_with_comma_separator%7D%7D",
              options: {
                product: {
                  buttonDestination: "modal",
                  contents: {
                    img: true,
                    title: true,
                    price: true,
                    options: false,
                    quantity: false,
                    button: true,
                    buttonWithQuantity: false,
                  },
                  text: { button: "Voir" },
                  styles: {
                    product: {
                      "text-align": "left",
                      /* force ratio cÃ´tÃ© composant */
                      imgWrapper: {
                        position: "relative",
                        width: "100%",
                        height: "auto",
                        "aspect-ratio": "4 / 5",
                      },
                      img: {
                        position: "absolute",
                        inset: "0",
                        width: "100%",
                        height: "100%",
                        "object-fit": "cover",
                      },
                    },
                    title: { color: "#1f1f1f", "font-weight": "600" },
                    price: { color: "#333" },
                    button: {
                      "background-color": "#e96878",
                      "border-radius": "0",
                    },
                  },
                },
                productSet: {
                  styles: { products: { "align-items": "stretch" } },
                },
                modalProduct: {
                  contents: {
                    img: false,
                    imgWithCarousel: true,
                    button: false,
                    buttonWithQuantity: true,
                  },
                  text: { button: "Ajouter au panier" },
                  styles: {
                    button: {
                      "background-color": "#e96878",
                      "border-radius": "0",
                    },
                  },
                },
                cart: {
                  popup: false,
                  styles: {
                    button: {
                      "background-color": "#e96878",
                      "border-radius": "0",
                    },
                    cart: { "background-color": "#e8dbcd" },
                    footer: { "background-color": "#e8dbcd" },
                  },
                  text: {
                    title: "Panier",
                    total: "Total",
                    empty: "Votre panier est vide ðŸ¥²",
                    notice:
                      "Les codes d'expÃ©dition et de rÃ©duction sont ajoutÃ©s lors du paiement.",
                    button: "Payer",
                  },
                },
                toggle: {
                  styles: { toggle: { "background-color": "#e96878" } },
                },
              },
            });

            // === Hover: swap vers 2e image si disponible ===
            client.collection
              .fetchWithProducts("REPLACE_COLLECTION_ID", {
                productsFirst: 250,
              })
              .then(function (col) {
                const map = new Map();
                col.products.forEach((p) => {
                  const imgs = p.images || [];
                  if (imgs.length > 1)
                    map.set(String(p.id), {
                      first: imgs[0].src,
                      second: imgs[1].src,
                    });
                });

                // MutationObserver pour attendre le rendu des cartes
                const grid = document.querySelector("#collection-node");
                const hook = () => {
                  document
                    .querySelectorAll(".shopify-buy__product")
                    .forEach((card) => {
                      const pid =
                        card.getAttribute("data-product-id") ||
                        card.dataset.productId;
                      if (!pid || !map.has(pid) || card.__hoverBound) return;
                      const imgEl = card.querySelector(
                        ".shopify-buy__product__image img, .shopify-buy__product__image, img"
                      );
                      if (!imgEl) return;
                      const { first, second } = map.get(pid);
                      let original = imgEl.getAttribute("src") || first;
                      card.__hoverBound = true;

                      card.addEventListener("mouseenter", () => {
                        if (second) imgEl.setAttribute("src", second);
                      });
                      card.addEventListener("mouseleave", () => {
                        imgEl.setAttribute("src", original);
                      });
                      // also on focus/blur for keyboard users
                      card.addEventListener("focusin", () => {
                        if (second) imgEl.setAttribute("src", second);
                      });
                      card.addEventListener("focusout", () => {
                        imgEl.setAttribute("src", original);
                      });
                    });
                };
                const mo = new MutationObserver(hook);
                mo.observe(grid, { childList: true, subtree: true });
                hook(); // premiÃ¨re passe
              });
          });
        }
      })();
    </script>
    <script src="script/script.js"></script>
  </body>
</html>
