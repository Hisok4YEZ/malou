<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="img/logo2.png" type="image/png" />

    <title>Catalogue â€“ Boutique</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Quicksand:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style/style.css" />
    <link rel="stylesheet" href="style/shop.css" />
    <link rel="stylesheet" href="style/header.css" />
    <link rel="stylesheet" href="style/footer.css" />
    <style>
      .product-thumb p {
        font-family: "Quicksand", sans-serif;
        font-weight: 700;
        font-size: 0.95rem;
        margin: 0.3rem 0 0.7rem;
        color: #3f3027;
      }
      .add-cart {
        background-color: #f3e9dc;
        color: #3f3027;
        border: none;
        padding: 0.5rem 1rem;
        font-weight: 600;
        font-family: "Quicksand", sans-serif;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      .add-cart:hover {
        background-color: #e6d5c5;
      }
      .catalogue-section h2 {
        font-family: "Cormorant Garamond", serif;
        font-size: 1.8rem;
        margin-bottom: 1rem;
        padding-left: 1rem;
        color: #3f3027;
      }
      .product-thumb img {
        border-radius: 0;
        width: 100%;
        display: block;
      }
      .catalogue-section {
        display: flex;
        justify-content: space-between;
        gap: 2rem;
        margin-bottom: 5rem;
      }
      .catalogue-featured {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .catalogue-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2rem;
      }
      .product-thumb {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
    </style>
  </head>
  <body class="catalogue-bg">
    <div class="bandeau-livraison">
      <div class="bandeau-slider">
        <div class="slide">
          livraison offerte en point relai Ã  partir de 80â‚¬ dâ€™achat
        </div>
        <div class="slide">
          Livraison offerte Ã  domicile Ã  partir de 100â‚¬ dâ€™achat
        </div>
        <div class="slide">
          livraison offerte en point relai Ã  partir de 80â‚¬ dâ€™achat
        </div>
        <div class="slide">
          Livraison offerte Ã  domicile Ã  partir de 100â‚¬ dâ€™achat
        </div>
      </div>
    </div>

    <div id="header"></div>

    <main class="collection-container">
      <!-- Sous-nav sticky pour sauter aux sections -->
      <nav class="catalogue-subnav" aria-label="CatÃ©gories">
        <a href="#c-robe">Robes</a>
        <a href="#c-Bas">Bas</a>
        <a href="#c-top">Tops</a>
      </nav>

      <!-- Sections de collections (placeholders) -->
      <section id="c-robe" class="catalogue-section">
        <h2>Robes</h2>
        <div id="node-robe" class="shopify-collection-node"></div>
      </section>

      <section id="c-Bas" class="catalogue-section">
        <h2>Bas</h2>
        <div id="node-Bas" class="shopify-collection-node"></div>
      </section>

      <section id="c-top" class="catalogue-section">
        <h2>Tops</h2>
        <div id="node-top" class="shopify-collection-node"></div>
      </section>
    </main>

    <!-- Script unique pour charger et afficher TOUTES les collections -->
    <script>
      /**
       * Page Catalogue â€” plusieurs collections empilÃ©es
       * - Charge le SDK Buy Button une seule fois
       * - Rend chaque collection par son ID Shopify
       * - Lazy render au scroll (perf)
       */

      (function () {
        var scriptURL =
          "https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js";

        // â†’ Remplace les IDs ci-dessous par TES IDs de collections Shopify
        //    (Shopify > Buy Button > CrÃ©er un bouton pour une Collection â†’ copie l'ID)
        var COLLECTIONS = [
          {
            key: "robe",
            title: "Robes",
            id: "677037146486",
            node: "node-robe",
          },
          {
            key: "Bas",
            title: "Bas",
            id: "677037244790",
            node: "node-Bas",
          },
          {
            key: "top",
            title: "Tops",
            id: "677037343094",
            node: "node-top",
          },
        ];

        // 1) Charger le SDK si nÃ©cessaire
        if (window.ShopifyBuy && window.ShopifyBuy.UI) {
          ShopifyBuyInit();
        } else {
          var s = document.createElement("script");
          s.async = true;
          s.src = scriptURL;
          s.onload = ShopifyBuyInit;
          (document.head || document.body).appendChild(s);
        }

        // 2) Initialisation Shopify + rendu lazy des collections
        function ShopifyBuyInit() {
          var client = ShopifyBuy.buildClient({
            domain: "eb1iv0-n1.myshopify.com",
            storefrontAccessToken: "5de76971549ee7a5dcb338aaad5e9784",
          });

          ShopifyBuy.UI.onReady(client).then(function (ui) {
            // Observateur pour "lazy render" : on ne crÃ©e la collection que quand la section entre en vue
            var io = new IntersectionObserver(
              function (entries) {
                entries.forEach(function (entry) {
                  if (!entry.isIntersecting) return;

                  var node = entry.target; // div.shopify-collection-node*
                  var key = node.id.replace("node-", "");
                  var conf = COLLECTIONS.find((c) => c.key === key);
                  if (!conf || node.dataset.rendered === "1") return;

                  node.dataset.rendered = "1"; // Ã©viter double rendu

                  ui.createComponent("collection", {
                    id: conf.id,
                    node: node,
                    moneyFormat:
                      "%E2%82%AC%7B%7Bamount_with_comma_separator%7D%7D",
                    options: {
                      product: {
                        // Ouvre la modale â†’ pas dâ€™ajout direct depuis la carte
                        buttonDestination: "modal",
                        contents: {
                          img: true,
                          title: true,
                          price: true,
                          options: false, // masque tailles/couleurs sur la carte
                          quantity: false,
                          button: true, // un SEUL bouton sur la carte = "Voir"
                          buttonWithQuantity: false,
                        },
                        text: { button: "Voir" },

                        styles: {
                          product: {
                            "text-align": "left",

                            /* >>> FORCE RATIO 4:5 CÃ”TÃ‰ COMPOSANT <<< */
                            imgWrapper: {
                              position: "relative",
                              width: "100%",
                              height: "auto",
                              "aspect-ratio": "4 / 5",
                              /* Fallback vieux navigateurs :
                                si aspect-ratio pas supportÃ©, on bascule via CSS plus bas */
                            },
                            button: {
                              "background-color": "#e96878",
                              "border-radius": "0",
                            },
                            img: {
                              position: "absolute",
                              inset: "0",
                              width: "100%",
                              height: "100%",
                              "object-fit": "cover",
                            },
                          },
                          /* ... title/price/button inchangÃ©s ... */
                        },
                      },
                      productSet: {
                        styles: { products: { "align-items": "stretch" } },
                      },
                      modalProduct: {
                        contents: {
                          img: false,
                          imgWithCarousel: true,
                          button: false,
                          buttonWithQuantity: true, // le SEUL bouton dâ€™achat est ici
                        },
                        text: { button: "Ajouter au panier" },
                        styles: {
                          button: {
                            "background-color": "#000",
                            "border-radius": "0",
                          },
                        },
                      },
                      cart: {
                        popup: false,
                        styles: {
                          cart: { "background-color": "#e8dbcd" },
                          footer: { "background-color": "#e8dbcd" },
                          button: {
                            "background-color": "#000",
                            "border-radius": "0",
                          },
                        },
                        text: {
                          title: "Panier",
                          total: "Total",
                          empty: "Votre panier est vide ðŸ¥²",
                          notice:
                            "Les codes d'expÃ©dition et de rÃ©duction sont ajoutÃ©s lors du paiement.",
                          button: "Payer",
                        },
                      },
                      toggle: {
                        styles: { toggle: { "background-color": "#000" } },
                      },
                    },
                  });

                  io.unobserve(node);
                });
              },
              { root: null, rootMargin: "120px 0px", threshold: 0.01 }
            );

            // Activer lâ€™observer sur chaque placeholder
            document
              .querySelectorAll(".shopify-collection-node")
              .forEach(function (n) {
                io.observe(n);
              });
          });
        }
      })();
    </script>
    <script>
      /* ===== Onglets Robes/Bas/Tops avec anim up/down ===== */
      document.addEventListener("DOMContentLoaded", () => {
        const order = ["robe", "Bas", "top"]; // lâ€™ordre visuel de tes onglets
        const tabs = [...document.querySelectorAll(".catalogue-subnav a")];
        const sections = (key) => document.querySelector(`#c-${key}`);

        // Ã©tat initial : activer la 1Ã¨re section
        function activate(key, dir) {
          // nav active
          tabs.forEach((a) =>
            a.classList.toggle("active", a.getAttribute("href") === `#c-${key}`)
          );
          // sections
          ["robe", "Bas", "top"].forEach((k) => {
            const s = sections(k);
            if (!s) return;
            s.classList.remove("is-active", "anim-down", "anim-up");
          });
          const act = sections(key);
          if (act) {
            act.classList.add(
              "is-active",
              dir === "down" ? "anim-down" : "anim-up"
            );
            // si la collection n'a pas encore Ã©tÃ© rendue par l'observer, on scrolle quand mÃªme au bloc
            act.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        }

        // click handling + direction
        tabs.forEach((a) => {
          a.addEventListener("click", (e) => {
            e.preventDefault();
            const targetKey = a.getAttribute("href").replace("#c-", "");
            const current = document.querySelector(
              ".catalogue-subnav a.active"
            );
            const currentKey = current
              ? current.getAttribute("href").replace("#c-", "")
              : order[0];
            const dir =
              order.indexOf(targetKey) > order.indexOf(currentKey)
                ? "down"
                : "up";
            activate(targetKey, dir);
          });
        });

        // activer par dÃ©faut (1er onglet) ou par hash si prÃ©sent
        const initial =
          location.hash && location.hash.startsWith("#c-")
            ? location.hash.replace("#c-", "")
            : order[0];
        activate(initial, "down");
      });
    </script>

    <div id="footer"></div>
    <script src="script/script.js"></script>
  </body>
</html>
